import{r as c,m as E,o as l,c as a,d as e,t as o,i as M,F as b,k as C,w as D,p as L,a as N,b as k,n as U}from"./index-6d500333.js";import{u as B,a as x}from"./toastMessage-b1d96b7b.js";import{u as j,_ as q}from"./DelModal-525a304c.js";import{_ as z}from"./Pagination-4dfee9bb.js";const F={class:"modal-dialog modal-xl",role:"document"},A={class:"modal-content border-0"},I=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body"},G={class:"row"},H={class:"col-md-4"},J=e("h3",null,"用戶資料",-1),K={class:"table"},Q={key:0},W=e("th",{style:{width:"100px"}},"姓名",-1),X=e("th",null,"Email",-1),Y=e("th",null,"電話",-1),Z=e("th",null,"地址",-1),ee={class:"col-md-8"},te=e("h3",null,"訂單細節",-1),se={class:"table"},le=e("th",{style:{width:"100px"}},"訂單編號",-1),ae=e("th",null,"下單時間",-1),oe=e("th",null,"付款時間",-1),ne={key:0},de={key:1},ue=e("th",null,"付款狀態",-1),ie={key:0,class:"text-success"},ce={key:1,class:"text-muted"},re=e("th",null,"總金額",-1),_e=e("h3",null,"選購商品",-1),he={class:"table"},pe=e("thead",null,[e("tr")],-1),ve={class:"text-end"},me={class:"d-flex justify-content-end"},fe={class:"form-check"},be={class:"form-check-label",for:"flexCheckDefault"},ye={key:0},ke={key:1},$e={class:"modal-footer"},ge=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),xe={__name:"OrderModal",props:{order:Object},emits:["update-paid"],setup(w,{expose:$,emit:h}){const v=w,{openModal:m,hideModal:f,modalRef:g}=j(),t=c({});return E(()=>v.order,n=>{t.value=n}),$({openModal:m,hideModal:f}),(n,u)=>(l(),a("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:g},[e("div",F,[e("div",A,[I,e("div",T,[e("div",G,[e("div",H,[J,e("table",K,[t.value.user?(l(),a("tbody",Q,[e("tr",null,[W,e("td",null,o(t.value.user.name),1)]),e("tr",null,[X,e("td",null,o(t.value.user.email),1)]),e("tr",null,[Y,e("td",null,o(t.value.user.tel),1)]),e("tr",null,[Z,e("td",null,o(t.value.user.address),1)])])):M("",!0)])]),e("div",ee,[te,e("table",se,[e("tbody",null,[e("tr",null,[le,e("td",null,o(t.value.id),1)]),e("tr",null,[ae,e("td",null,o(n.$filters.date(t.value.create_at)),1)]),e("tr",null,[oe,e("td",null,[t.value.paid_date?(l(),a("span",ne,o(n.$filters.date(t.value.paid_date)),1)):(l(),a("span",de,"時間不正確"))])]),e("tr",null,[ue,e("td",null,[t.value.is_paid?(l(),a("strong",ie,"已付款")):(l(),a("span",ce,"尚未付款"))])]),e("tr",null,[re,e("td",null,o(n.$filters.currency(t.value.total)),1)])])]),_e,e("table",he,[pe,e("tbody",null,[(l(!0),a(b,null,C(t.value.products,i=>(l(),a("tr",{key:i.id},[e("th",null,o(i.product.title),1),e("td",null,o(i.qty)+" / "+o(i.product.unit),1),e("td",ve,o(n.$filters.currency(i.final_total)),1)]))),128))])]),e("div",me,[e("div",fe,[D(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":u[0]||(u[0]=i=>t.value.is_paid=i)},null,512),[[L,t.value.is_paid]]),e("label",be,[t.value.is_paid?(l(),a("span",ye,"已付款")):(l(),a("span",ke,"未付款"))])])])])])]),e("div",$e,[ge,e("button",{type:"button",class:"btn btn-primary",onClick:u[1]||(u[1]=i=>h("update-paid",t.value))}," 修改付款狀態 ")])])])],512))}},Me={class:"table mt-4"},Ce=e("thead",null,[e("tr",null,[e("th",null,"購買時間"),e("th",null,"Email"),e("th",null,"購買款項"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",null,"編輯")])],-1),we=["textContent"],Oe={class:"list-unstyled"},Ve={class:"text-right"},De={class:"form-check form-switch"},Le=["id","onUpdate:modelValue","onChange"],Re=["for"],Pe={key:0},Se={key:1},Ee={class:"btn-group"},Ne=["onClick"],Ue=["onClick"],Fe={__name:"AdminOrders",setup(w){const $=B(),{pushMessage:h}=$,v=c(null),m=c(null),f=c({}),g=c(!1),t=c({}),n=c(!1),u=c({}),i=c({}),O=c(1),y=(d=1)=>{const p=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/orders?page=${d}`;n.value=!0,x.get(p,i).then(_=>{f.value=_.data.orders,t.value=_.data.pagination,n.value=!1}).catch(_=>{n.value=!1,h({style:"danger",title:"錯誤訊息",content:_.response.data.message})})},R=d=>{u.value={...d},g.value=!1,v.value.openModal()},P=d=>{u.value={...d},m.value.openModal()},V=d=>{const p=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/order/${d.id}`,_={is_paid:d.is_paid};n.value=!0,x.put(p,{data:_}).then(s=>{n.value=!1,v.value.hideModal(),y(O.value),h({style:"success",title:"更新付款狀態",content:s.data.message})}).catch(s=>{n.value=!1,h({style:"danger",title:"錯誤訊息",content:s.response.data.message})})},S=()=>{const d=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/order/${u.value.id}`;n.value=!0,x.delete(d).then(()=>{n.value=!1,m.value.hideModal(),y(O.value)}).catch(p=>{n.value=!1,h({style:"danger",title:"錯誤訊息",content:p.response.data.message})})};return y(),(d,p)=>{const _=N("VueLoading");return l(),a(b,null,[k(_,{active:n.value,"z-index":1060},null,8,["active"]),e("table",Me,[Ce,e("tbody",null,[(l(!0),a(b,null,C(f.value,s=>(l(),a(b,{key:s.id},[f.value.length?(l(),a("tr",{key:0,class:U({"text-secondary":!s.is_paid})},[e("td",null,o(d.$filters.date(s.create_at)),1),e("td",null,[s.user?(l(),a("span",{key:0,textContent:o(s.user.email)},null,8,we)):M("",!0)]),e("td",null,[e("ul",Oe,[(l(!0),a(b,null,C(s.products,r=>(l(),a("li",{key:r.id},o(r.product.title)+" 數量："+o(r.qty)+" "+o(r.product.unit),1))),128))])]),e("td",Ve,o(s.total),1),e("td",null,[e("div",De,[D(e("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${s.id}`,"onUpdate:modelValue":r=>s.is_paid=r,onChange:r=>V(s)},null,40,Le),[[L,s.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${s.id}`},[s.is_paid?(l(),a("span",Pe,"已付款")):(l(),a("span",Se,"未付款"))],8,Re)])]),e("td",null,[e("div",Ee,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:r=>R(s)}," 檢視 ",8,Ne),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:r=>P(s)}," 刪除 ",8,Ue)])])],2)):M("",!0)],64))),128))])]),k(xe,{order:u.value,ref_key:"orderModalRef",ref:v,onUpdatePaid:V},null,8,["order"]),k(q,{item:u.value,ref_key:"delModalRef",ref:m,onDelItem:S},null,8,["item"]),k(z,{pages:t.value,onEmitPages:y},null,8,["pages"])],64)}}};export{Fe as default};
