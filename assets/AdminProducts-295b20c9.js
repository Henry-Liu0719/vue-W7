import{u as N,a as M}from"./toastMessage-b1d96b7b.js";import{u as D,_ as L}from"./DelModal-525a304c.js";import{_ as B}from"./Pagination-4dfee9bb.js";import{r as p,m as S,o as a,c as n,d as e,w as r,v as m,g as T,i as P,F as R,k as F,p as I,a as E,b as $,t as k}from"./index-6d500333.js";const j={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},A={class:"modal-header bg-dark text-white"},O={class:"modal-title",id:"exampleModalLabel"},q={key:0},G={key:1},H=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-3"},X=e("label",{for:"image",class:"form-label"},"輸入圖片網址",-1),Y={class:"mb-3"},Z={for:"customFile",class:"form-label"},ee={key:0,class:"fas fa-spinner fa-spin"},te=["src"],le={key:0,class:"mt-5"},se=["onUpdate:modelValue"],oe=["src"],ae=["onClick"],ne={key:0},ie={class:"col-sm-8"},de={class:"mb-3"},ce=e("label",{for:"title",class:"form-label"},"標題",-1),ue={class:"row gx-2"},re={class:"mb-3 col-md-6"},pe=e("label",{for:"category",class:"form-label"},"分類",-1),me={class:"mb-3 col-md-6"},ve=e("label",{for:"price",class:"form-label"},"單位",-1),_e={class:"row gx-2"},he={class:"mb-3 col-md-6"},fe=e("label",{for:"origin_price",class:"form-label"},"原價",-1),be={class:"mb-3 col-md-6"},ge=e("label",{for:"price",class:"form-label"},"售價",-1),ye=e("hr",null,null,-1),xe={class:"mb-3"},Ue=e("label",{for:"description",class:"form-label"},"產品描述",-1),$e={class:"mb-3"},ke=e("label",{for:"content",class:"form-label"},"說明內容",-1),Me={class:"mb-3"},we={class:"form-check"},Ve=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Ce={class:"modal-footer"},Pe=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Ne={__name:"ProductModal",props:{product:Object,isNew:Boolean},emits:["update-product"],setup(w,{expose:V,emit:v}){const x=w,U=N(),{pushMessage:i}=U,{openModal:f,hideModal:d,modalRef:g}=D(),_=p(null),t=p({}),h=p({fileUploading:!1});S(()=>x.product,b=>{t.value=b,t.value.imagesUrl||(t.value.imagesUrl=[]),t.value.imageUrl||(t.value.imageUrl="")});const C=()=>{const b=_.value.files[0],s=new FormData;s.append("file-to-upload",b);const l="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/upload";h.value.fileUploading=!0,M.post(l,s,{headers:{"Content-Type":"multipart/form-data"}}).then(o=>{h.value.fileUploading=!1,t.value.imageUrl=o.data.imageUrl,_.value.value="",i({style:"success",title:"圖片上傳結果",content:o.data.message})}).catch(o=>{h.value.fileUploading=!1,i({style:"danger",title:"圖片上傳結果",content:o.response.data.message})})};return V({openModal:f,hideModal:d}),(b,s)=>(a(),n("div",{class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalRef",ref:g},[e("div",j,[e("div",z,[e("div",A,[e("h5",O,[w.isNew?(a(),n("span",q,"新增產品")):(a(),n("span",G,"編輯產品"))]),H]),e("div",J,[e("div",K,[e("div",Q,[e("div",W,[X,r(e("input",{type:"text",class:"form-control",id:"image","onUpdate:modelValue":s[0]||(s[0]=l=>t.value.imageUrl=l),placeholder:"請輸入圖片連結"},null,512),[[m,t.value.imageUrl]])]),e("div",Y,[e("label",Z,[T("或 上傳圖片 "),h.value.fileUploading?(a(),n("i",ee)):P("",!0)]),e("input",{type:"file",id:"customFile",class:"form-control",ref_key:"fileInputRef",ref:_,onChange:C},null,544)]),e("img",{class:"img-fluid",src:t.value.imageUrl},null,8,te),t.value.imagesUrl?(a(),n("div",le,[(a(!0),n(R,null,F(t.value.imagesUrl,(l,o)=>(a(),n("div",{class:"mb-3",key:o},[r(e("input",{type:"url",class:"form-control form-control","onUpdate:modelValue":c=>t.value.imagesUrl[o]=c,placeholder:"請輸入連結"},null,8,se),[[m,t.value.imagesUrl[o]]]),e("div",null,[e("img",{class:"img-fluid",src:l},null,8,oe)]),e("button",{type:"button",class:"btn btn-outline-danger",onClick:c=>t.value.imagesUrl.splice(o,1)}," 移除 ",8,ae)]))),128)),t.value.imagesUrl[t.value.imagesUrl.length-1]||!t.value.imagesUrl.length?(a(),n("div",ne,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:s[1]||(s[1]=l=>t.value.imagesUrl.push(""))}," 新增圖片 ")])):P("",!0)])):P("",!0)]),e("div",ie,[e("div",de,[ce,r(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":s[2]||(s[2]=l=>t.value.title=l),placeholder:"請輸入標題"},null,512),[[m,t.value.title]])]),e("div",ue,[e("div",re,[pe,r(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":s[3]||(s[3]=l=>t.value.category=l),placeholder:"請輸入分類"},null,512),[[m,t.value.category]])]),e("div",me,[ve,r(e("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":s[4]||(s[4]=l=>t.value.unit=l),placeholder:"請輸入單位"},null,512),[[m,t.value.unit]])])]),e("div",_e,[e("div",he,[fe,r(e("input",{type:"number",class:"form-control",id:"origin_price",min:"0","onUpdate:modelValue":s[5]||(s[5]=l=>t.value.origin_price=l),placeholder:"請輸入原價"},null,512),[[m,t.value.origin_price,void 0,{number:!0}]])]),e("div",be,[ge,r(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":s[6]||(s[6]=l=>t.value.price=l),min:"0",placeholder:"請輸入售價"},null,512),[[m,t.value.price,void 0,{number:!0}]])])]),ye,e("div",xe,[Ue,r(e("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":s[7]||(s[7]=l=>t.value.description=l),placeholder:"請輸入產品描述"},null,512),[[m,t.value.description]])]),e("div",$e,[ke,r(e("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":s[8]||(s[8]=l=>t.value.content=l),placeholder:"請輸入產品說明內容"},null,512),[[m,t.value.content]])]),e("div",Me,[e("div",we,[r(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[9]||(s[9]=l=>t.value.is_enabled=l),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[I,t.value.is_enabled]]),Ve])])])])]),e("div",Ce,[Pe,e("button",{type:"button",class:"btn btn-primary",onClick:s[10]||(s[10]=l=>v("update-product",t.value))}," 確認 ")])])])],512))}},Re={class:"text-end mt-4"},Fe={class:"table mt-4"},De=e("thead",null,[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",{width:"120"},"原價"),e("th",{width:"120"},"售價"),e("th",{width:"100"},"是否啟用"),e("th",{width:"200"},"編輯")])],-1),Le={class:"text-right"},Be={class:"text-right"},Se={key:0,class:"text-success"},Te={key:1},Ie={class:"btn-group"},Ee=["onClick"],je=["onClick"],Ge={__name:"AdminProducts",setup(w){const V=N(),{pushMessage:v}=V,x=p([]),U=p({}),i=p({}),f=p(!1),d=p(!1),g=p(null),_=p(null),t=(l=1)=>{const o=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/products?page=${l}`;d.value=!0,M.get(o).then(c=>{x.value=c.data.products,U.value=c.data.pagination,d.value=!1,v({style:"success",title:"成功取得產品資訊",content:"已成功取得產品資訊"})}).catch(c=>{d.value=!1,v({style:"danger",title:"錯誤訊息",content:c.response.data.message})})},h=(l,o)=>{l?(i.value={},f.value=!0):(i.value={...o},f.value=!1),g.value.openModal()},C=l=>{i.value=l;let o="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/product";d.value=!0;let c="post",u="新增產品";f.value||(o=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/product/${i.value.id}`,c="put",u="更新產品"),g.value.hideModal(),M[c](o,{data:i.value}).then(y=>{d.value=!1,v({style:"success",title:u,content:y.data.message}),t()}).catch(y=>{d.value=!1,v({style:"danger",title:"錯誤訊息",content:y.response.data.message})})},b=l=>{i.value={...l},_.value.openModal()},s=()=>{const l=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/admin/product/${i.value.id}`;d.value=!0,M.delete(l).then(o=>{d.value=!1,v({style:"success",title:"刪除產品",content:o.data.message}),_.value.hideModal(),t()}).catch(o=>{d.value=!1,v({style:"danger",title:"錯誤訊息",content:o.response.data.message})})};return t(),(l,o)=>{const c=E("VueLoading");return a(),n("div",null,[$(c,{active:d.value,"z-index":1060},null,8,["active"]),e("div",Re,[e("button",{class:"btn btn-primary",type:"button",onClick:o[0]||(o[0]=u=>h(!0))}," 建立新的產品 ")]),e("table",Fe,[De,e("tbody",null,[(a(!0),n(R,null,F(x.value,u=>(a(),n("tr",{key:u.id},[e("td",null,k(u.category),1),e("td",null,k(u.title),1),e("td",Le,k(l.$filters.currency(u.origin_price)),1),e("td",Be,k(l.$filters.currency(u.price)),1),e("td",null,[u.is_enabled?(a(),n("span",Se,"啟用")):(a(),n("span",Te,"未啟用"))]),e("td",null,[e("div",Ie,[e("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:y=>h(!1,u)}," 編輯 ",8,Ee),e("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:y=>b(u)}," 刪除 ",8,je)])])]))),128))])]),$(B,{pages:U.value,onEmitPages:t},null,8,["pages"]),$(Ne,{onUpdateProduct:C,product:i.value,isNew:f.value,ref_key:"productModalRef",ref:g},null,8,["product","isNew"]),$(L,{item:i.value,ref_key:"delModalRef",ref:_,onDelItem:s},null,8,["item"])])}}};export{Ge as default};
