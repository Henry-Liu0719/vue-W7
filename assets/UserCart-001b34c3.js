import{u as P,r as b,a as x,o as u,c as d,b as p,d as e,F as C,k as M,i as m,t as _,w as I,v as U,f as j,A as O,g as k,n as $}from"./index-6d500333.js";import{u as G,a as f}from"./toastMessage-b1d96b7b.js";const H={class:"container"},J={class:"mt-4"},K={class:"table align-middle"},Q=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"商品名稱"),e("th",null,"價格"),e("th",null,"功能")])],-1),W={style:{width:"200px"}},X={href:"#",class:"text-dark"},Y={key:0,class:"h5"},Z={key:1,class:"h6"},ee={key:2,class:"h5"},te={class:"btn-group btn-group-sm"},se=["disabled","onClick"],le={key:0,class:"spinner-border spinner-grow-sm"},ae=["onClick","disabled"],oe={key:0,class:"spinner-border spinner-grow-sm"},ne={class:"table align-middle"},ce=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"110px"}},"數量"),e("th",null,"單價")])],-1),ue=["disabled","onClick"],de=e("i",{class:"bi bi-x"},null,-1),re=[de],ie={key:0,class:"text-success"},pe={class:"input-group input-group-sm"},ve=["onUpdate:modelValue","onBlur"],he={class:"input-group-text"},me={class:"text-end"},_e={key:0,class:"text-success"},ge=e("td",{colspan:"3",class:"text-end"},"總計",-1),be={class:"text-end"},fe={key:0},ye=e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),xe={class:"text-end text-success"},ke={class:"input-group mb-3 input-group-sm"},$e={class:"my-5 row justify-content-center"},Ve={class:"mb-3"},Ce=e("label",{for:"email",class:"form-label"},"Email",-1),Ie={class:"mb-3"},Ue=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),we={class:"mb-3"},qe=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),Fe={class:"mb-3"},Me=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Be={class:"mb-3"},Ee=e("label",{for:"message",class:"form-label"},"留言",-1),Se=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1),Te={__name:"UserCart",setup(ze){const B=G(),{pushMessage:n}=B,w=P(),q=b([]);b({});const v=b({loadingItem:""}),F=b(null),r=b({user:{name:"",email:"",tel:"",address:""},message:""}),h=b({}),l=b(!1),V=b(""),E=()=>{const a="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/products";l.value=!0,f.get(a).then(t=>{q.value=t.data.products,l.value=!1}).catch(t=>{l.value=!1,n({style:"danger",title:"錯誤訊息",content:t.response.data.message})})},S=a=>{w.push(`/user/product/${a}`)},z=(a,t=1)=>{l.value=!0;const c="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart";v.value.loadingItem=a;const i={product_id:a,qty:t};f.post(c,{data:i}).then(g=>{v.value.loadingItem="",l.value=!1,n({style:"success",title:"加入購物車",content:g.data.message}),y()}).catch(g=>{l.value=!1,n({style:"danger",title:"加入購物車",content:g.response.data.message})})},L=()=>{l.value=!0;const a="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/carts";f.delete(a).then(t=>{n({style:"success",title:"清除購物車",content:t.data.message}),y(),l.value=!1}).catch(t=>{l.value=!1,n({style:"danger",title:"清除購物車",content:t.response.data.message})})},y=()=>{const a="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart";l.value=!0,f.get(a).then(t=>{h.value=t.data.data,l.value=!1}).catch(t=>{l.value=!1,n({style:"danger",title:"錯誤訊息",content:t.response.data.message})})},N=a=>{v.value.loadingItem=a;const t=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart/${a}`;l.value=!0,f.delete(t).then(c=>{n({style:"success",title:"移除購物車品項",content:c.data.message}),v.value.loadingItem="",l.value=!1,y()}).catch(c=>{l.value=!1,n({style:"danger",title:"移除購物車品項",content:c.response.data.message})})},T=a=>{l.value=!0;const t=`https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/cart/${a.id}`,c={product_id:a.product_id,qty:a.qty};f.put(t,{data:c}).then(i=>{l.value=!1,n({style:"success",title:"更新購物車",content:i.data.message}),y()}).catch(i=>{l.value=!1,n({style:"danger",title:"更新購物車",content:i.response.data.message})})},R=()=>{const a="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/coupon",t={code:V.value};l.value=!0,f.post(a,{data:t}).then(c=>{n({style:"success",title:"加入優惠券",content:c.data.message}),y(),l.value=!1}).catch(c=>{l.value=!1,n({style:"danger",title:"加入優惠券",content:c.response.data.message})})},A=()=>{l.value=!0;const a="https://vue3-course-api.hexschool.io/v2//api/hexschoolvue/order";f.post(a,{data:r.value}).then(t=>{n({style:"success",title:"建立訂單",content:t.data.message}),w.push(`/user/checkout/${t.data.orderId}`),F.value.resetForm(),l.value=!1}).catch(t=>{l.value=!1,n({style:"danger",title:"建立訂單",content:t.response.data.message})})};return E(),y(),(a,t)=>{const c=x("VueLoading"),i=x("VeeField"),g=x("ErrorMessage"),D=x("VeeForm");return u(),d(C,null,[p(c,{active:l.value,"z-index":1060},null,8,["active"]),e("div",H,[e("div",J,[e("table",K,[Q,e("tbody",null,[(u(!0),d(C,null,M(q.value,s=>(u(),d("tr",{key:s.id},[e("td",W,[e("div",{style:O([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${s.imageUrl})`}])},null,4)]),e("td",null,[e("a",X,_(s.title),1)]),e("td",null,[s.price?m("",!0):(u(),d("div",Y,_(s.origin_price)+" 元 ",1)),s.price?(u(),d("del",Z,"原價 "+_(s.origin_price)+" 元",1)):m("",!0),s.price?(u(),d("div",ee," 現在只要 "+_(s.price)+" 元 ",1)):m("",!0)]),e("td",null,[e("div",te,[e("button",{type:"button",class:"btn btn-outline-secondary",disabled:v.value.loadingItem===s.id||!s.is_enabled,onClick:o=>S(s.id)},[v.value.loadingItem===s.id?(u(),d("span",le)):m("",!0),k(" 查看更多 ")],8,se),e("button",{type:"button",class:"btn btn-outline-danger",onClick:o=>z(s.id),disabled:v.value.loadingItem===s.id||!s.is_enabled},[v.value.loadingItem===s.id?(u(),d("span",oe)):m("",!0),k(" 加到購物車 ")],8,ae)])])]))),128))])]),e("div",{class:"text-end"},[e("button",{class:"btn btn-outline-danger",type:"button",onClick:L}," 清空購物車 ")]),e("table",ne,[ce,e("tbody",null,[h.value.carts?(u(!0),d(C,{key:0},M(h.value.carts,s=>(u(),d("tr",{key:s.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:v.value.loadingItem===s.id,onClick:o=>N(s.id)},re,8,ue)]),e("td",null,[k(_(s.product.title)+" ",1),s.coupon?(u(),d("div",ie,"已套用優惠券")):m("",!0)]),e("td",null,[e("div",pe,[I(e("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":o=>s.qty=o,onBlur:o=>T(s)},null,40,ve),[[U,s.qty,void 0,{number:!0}]]),e("div",he,"/ "+_(s.product.unit),1)])]),e("td",me,[h.value.final_total!==h.value.total?(u(),d("small",_e,"折扣價：")):m("",!0),k(" "+_(a.$filters.currency(s.final_total)),1)])]))),128)):m("",!0)]),e("tfoot",null,[e("tr",null,[ge,e("td",be,_(a.$filters.currency(h.value.total)),1)]),h.value.final_total!==h.value.total?(u(),d("tr",fe,[ye,e("td",xe,_(a.$filters.currency(h.value.final_total)),1)])):m("",!0)])]),e("div",ke,[I(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=s=>V.value=s),placeholder:"請輸入優惠碼"},null,512),[[U,V.value]]),e("div",{class:"input-group-append"},[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:R}," 套用優惠碼 ")])])]),e("div",$e,[p(D,{ref_key:"formRef",ref:F,class:"col-md-6",onSubmit:A},{default:j(({errors:s})=>[e("div",Ve,[Ce,p(i,{id:"email",name:"email",type:"email",class:$(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:r.value.user.email,"onUpdate:modelValue":t[1]||(t[1]=o=>r.value.user.email=o)},null,8,["class","modelValue"]),p(g,{name:"email",class:"invalid-feedback"})]),e("div",Ie,[Ue,p(i,{id:"name",name:"姓名",type:"text",class:$(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:r.value.user.name,"onUpdate:modelValue":t[2]||(t[2]=o=>r.value.user.name=o)},null,8,["class","modelValue"]),p(g,{name:"姓名",class:"invalid-feedback"})]),e("div",we,[qe,p(i,{id:"tel",name:"電話",type:"tel",class:$(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10",modelValue:r.value.user.tel,"onUpdate:modelValue":t[3]||(t[3]=o=>r.value.user.tel=o)},null,8,["class","modelValue"]),p(g,{name:"電話",class:"invalid-feedback"})]),e("div",Fe,[Me,p(i,{id:"address",name:"地址",type:"text",class:$(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:r.value.user.address,"onUpdate:modelValue":t[4]||(t[4]=o=>r.value.user.address=o)},null,8,["class","modelValue"]),p(g,{name:"地址",class:"invalid-feedback"})]),e("div",Be,[Ee,I(e("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[5]||(t[5]=o=>r.value.message=o)},null,512),[[U,r.value.message]])]),Se]),_:1},512)])])],64)}}};export{Te as default};
